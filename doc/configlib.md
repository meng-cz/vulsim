# VulSim 配置参数库 VulConfigLib

每一个项目有一个全局单例的配置参数库，每一个配置参数为`<name, value>`对，表示一个`int64_t`类型的整数常量

## 配置名规则与分组

配置参数名**项目全局唯一**（包含所有线组名、类名、实例名等），建议命名规则为全大写下划线分割，如`ICACHE_NUM_ENTRIES`。

每一个参数可以被划到一个参数组内，如果没有指定分组则会被分到默认组中。参数组名为**局部唯一**。参数组仅用于快速索引参数，并不会影响参数名索引的效果，同时跨组的参数也不能重名。

当导入预制件时，预制件所定义的参数会以预制件名作为分组加入参数库。

## 参数值与表达式

配置参数值是一个字符串表达式，包含常量、其他配置参数名、和运算符号。

所有合法的参数表达式运算符如下（按照算符优先级从高到底排序）：

| 优先级 | 算符 | 结合方向 | 说明 |
|----|----|----|----|
| 0 | () | 无 | 小括号，用于覆盖其他算符优先级 |
| 1 | @ | 右 | log2ceil，如@8=3，@15=4 |
| 1 | - | 右 | 负号 |
| 1 | ~ | 右 | 按位取反 |
| 1 | ! | 右 | 逻辑取反 |
| 2 | * | 左 | 整数乘法 |
| 2 | / | 左 | 整数除法 |
| 2 | % | 左 | 整数取余 |
| 3 | + | 左 | 整数加法 |
| 3 | - | 左 | 整数减法 |
| 4 | << | 左 | 整数逻辑左移 |
| 4 | >> | 左 | 整数算术右移 |
| 5 | < | 左 | 小于 |
| 5 | <= | 左 | 小于等于 |
| 5 | > | 左 | 大于 |
| 5 | >= | 左 | 大于等于 |
| 6 | == | 左 | 等于 |
| 6 | != | 左 | 不等于 |
| 7 | & | 左 | 按位与 |
| 8 | ^ | 左 | 按位异或 |
| 9 | \| | 左 | 按位或 |
| 10 | && | 左 | 逻辑与 |
| 11 | \|\| | 左 | 逻辑或 |
| 12 | ?: | 右 | 三元条件运算符 |

如果参数表达式中引用了其他参数名，则会自动解析引用并计算最终值。仅引用参数名即可，不需要加分组。例如：

```
"PARAM_A" = "8"
"PARAM_B" = "@PARAM_A * 2 + 4" // PARAM_B的值为log2ceil(8)*2+4=3*2+4=10
```

在配置参数库中的参数是无序的，引用时仅需保证被引用的参数已经存在即可。实际赋值顺序会在生成代码时根据引用关系进行拓扑排序。

循环引用是非法的，会导致报错。例如：

```
"PARAM_A" = "PARAM_B + 1"
"PARAM_B" = "PARAM_A + 1"
```