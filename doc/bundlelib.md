# VulSim 线组结构库 VulBundleLib

每一个项目有一个全局单例的线组结构库，保存所有线组的定义信息。

线组是模拟器中用于组织数据结构的单元，一个线组包含了一组相关的信号定义。

## 线组名

线组由线组名`name`进行索引，线组名为**项目全局唯一**，建议命名规则为大写开头的驼峰命名，如`IfuToDecodePack`。

## 线组Tag

每一个线组可以有多个字符串Tag，用于标记线组的属性和来源。

用户定义的线组包含默认Tag `__default__`。由预制件引入的线组包含预制件名作为Tag，例如预制件`MyBundlePreset`定义的线组会包含Tag `MyBundlePreset`。

带有非默认Tag的线组不可被修改、重命名、或删除，只能通过移除对应预制件来间接删除。

用户可以定义与预制件中线组同名的线组，但其定义必须与预制件中线组完全一致，此时同名线组的Tag会叠加。如果多个预制件或用户同时定义了相同的同名线组，当一个预制件被移除时，仍然会保留该线组，直到所有Tag都被移除为止。

## 线组常量

线组定义中的常量`constant`可以包含参数表达式，支持引用配置参数库中的参数名，运算规则与配置参数库相同。

## 枚举线组

枚举线组是特殊的线组类型，用于定义一组相关的枚举值。枚举线组成员为`<name, constant>`对，表示一个正整数常量。

枚举线组成员名**局部唯一**。

当`constant`被省略时，成员值自动递增。

枚举线组的实际位宽会在生成时根据成员值自动计算，位宽为能够表示所有成员值的最小位宽。

枚举线组不能包含其他类型的线组成员，仅能包含枚举成员。

## 别名线组

别名线组用于为已有数据结构创建一个新的名称，便于在不同上下文中使用相同的数据结构。其`is_alias`属性为`true`。

别名线组仅包含一个成员，用于表示别名目标。可以是任意合法的基础类型成员、不规整整数成员、基础类型数组成员、不规整整数数组成员。

## 基础类型成员

基础类型线组成员用于表示基本数据类型的信号，如规整长度整数、布尔值等。基础类型线组成员包含以下属性：

- `name`：成员名，**局部唯一**。
- `type`：成员类型，支持以下类型：
  - `uintN`：无符号整数，N为位宽，支持8，16，32，64，128，如`uint8`表示8位无符号整数。
  - `intN`：有符号整数，N为位宽，支持8，16，32，64，128，如`int16`表示16位有符号整数。
  - `bool`：布尔值，表示真或假。
  - 其他线组名

## 不规整整数成员

不规整整数线组成员用于表示非标准位宽的无符号整数信号。包含以下属性：

- `name`：成员名，**局部唯一**。
- `length`：位宽，任意正整数常量。

## 基础类型数组成员

基础类型数组线组成员用于表示基础类型的数组信号。包含以下属性：

- `name`：成员名，**局部唯一**。
- `type`：成员类型，支持基础类型，如`uint32`、`int16`、`bool`等，和其他线组名。
- `dims`：数组维度列表，为一组正整数常量，表示数组的各个维度长度。

## 不规整整数数组成员

不规整整数数组线组成员用于表示不规整整数的数组信号。包含以下属性：

- `name`：成员名，**局部唯一**。
- `length`：位宽，任意正整数常量。
- `dims`：数组维度列表，为一组正整数常量，表示数组的各个维度长度。

## 线组嵌套

线组成员可以在`type`字段引用其他线组作为其类型，实现线组的嵌套定义。

线组嵌套可以与数组定义结合使用，实现复杂的数据结构表示。

线组嵌套不可形成循环引用，否则会导致报错。

在生成代码时，线组的实际定义顺序会根据引用关系进行拓扑排序。
